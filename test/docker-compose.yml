services:
  sip_server:
    image: kamailio4sipmediagw
    build:
        context: ..
        dockerfile: ./test/kamailio/Dockerfile
    container_name: kamailio
    network_mode: host
    volumes:
            - kamailio-db:/usr/local/etc/kamailio
            #- ./kamailio/kamailio_db:/usr/local/etc/kamailio
    logging:
      driver: syslog
      options:
        tag: "kamailio"
    environment:
        SIP_DOMAIN: 192.168.92.1
        LOCAL_IP: 192.168.92.1
        PUBLIC_IP: 192.168.92.1
    entrypoint :
        - "/bin/sh"
        - "-c"
        - "cron && kamailioRun"

  turn_server:
    image: coturn/coturn
    container_name: coturn
    network_mode: host
    logging:
      driver: syslog
      options:
        tag: "coturn"
    command:
        - "--log-file=stdout"
        - "--external-ip=192.168.92.1"
        - "--lt-cred-mech"
        - "--user=dmo:1234"
        - "--min-port=40000"
        - "--max-port=49999"

volumes:
  kamailio-db:
